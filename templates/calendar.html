{% extends "base.html" %}

{% block content %}
<div class="calendar-container">
    <h1 class="text-center mb-4">üìÖ –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–µ –Ω–∞–≥—Ä–∞–¥—ã</h1>
    
    <div class="row">
        <!-- –ö–∞–ª–µ–Ω–¥–∞—Ä—å –Ω–∞–≥—Ä–∞–¥ -->
        <div class="col-md-8">
            <div class="calendar-main">
                <div class="calendar-header mb-4">
                    <h3>üéÅ –ö–∞–ª–µ–Ω–¥–∞—Ä—å –Ω–∞–≥—Ä–∞–¥</h3>
                    <p class="text-muted">–ó–∞—Ö–æ–¥–∏ –∫–∞–∂–¥—ã–π –¥–µ–Ω—å —á—Ç–æ–±—ã –ø–æ–ª—É—á–∞—Ç—å –±–æ–Ω—É—Å—ã!</p>
                </div>

                <div class="rewards-track">
                    {% for day in range(1, 31) %}
                    <div class="reward-item {% if day <= current_day %}available{% else %}locked{% endif %}" 
                         data-day="{{ day }}">
                        <div class="reward-day">–î–µ–Ω—å {{ day }}</div>
                        <div class="reward-content">
                            {% if day % 7 == 0 %}
                                <div class="reward-big">üéÅ</div>
                                <div class="reward-amount">5,000 UC</div>
                            {% elif day % 3 == 0 %}
                                <div class="reward-medium">üí∞</div>
                                <div class="reward-amount">1,000 UC</div>
                            {% else %}
                                <div class="reward-small">‚ö°</div>
                                <div class="reward-amount">500 UC</div>
                            {% endif %}
                        </div>
                        <div class="reward-status">
                            {% if day < current_day %}
                                <span class="claimed">‚úÖ</span>
                            {% elif day == current_day %}
                                {% if not claimed_today %}
                                <span class="available-text">–î–æ—Å—Ç—É–ø–Ω–æ</span>
                                {% else %}
                                <span class="claimed">‚úÖ</span>
                                {% endif %}
                            {% else %}
                                <span class="locked-text">üîí</span>
                            {% endif %}
                        </div>
                    </div>
                    {% endfor %}
                </div>

                <div class="calendar-info mt-4">
                    <div class="info-card">
                        <h5>üí° –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç?</h5>
                        <ul>
                            <li>–ö–∞–∂–¥—ã–π –¥–µ–Ω—å –¥–æ—Å—Ç—É–ø–Ω–∞ –Ω–æ–≤–∞—è –Ω–∞–≥—Ä–∞–¥–∞</li>
                            <li>–ù–µ –ø—Ä–æ–ø—É—Å–∫–∞–π—Ç–µ –¥–Ω–∏ - –Ω–∞–≥—Ä–∞–¥—ã —Å—Ç–∞–Ω–æ–≤—è—Ç—Å—è –ª—É—á—à–µ!</li>
                            <li>–ö–∞–∂–¥—ã–µ 7 –¥–Ω–µ–π - —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π –±–æ–Ω—É—Å!</li>
                            <li>–ï—Å–ª–∏ –ø—Ä–æ–ø—É—Å—Ç–∏–ª–∏ –¥–µ–Ω—å - —Ü–µ–ø–æ—á–∫–∞ –Ω–µ —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <!-- –ë–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å -->
        <div class="col-md-4">
            <div class="calendar-sidebar">
                <div class="stats-card mb-4">
                    <h5>üìä –í–∞—à–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h5>
                    <div class="stats-grid">
                        <div class="stat">
                            <span>–¢–µ–∫—É—â–∏–π –¥–µ–Ω—å:</span>
                            <strong>{{ current_day }}</strong>
                        </div>
                        <div class="stat">
                            <span>–í—Å–µ–≥–æ —Å–æ–±—Ä–∞–Ω–æ:</span>
                            <strong>{{ total_claimed }} UC</strong>
                        </div>
                        <div class="stat">
                            <span>–ü—Ä–æ–ø—É—â–µ–Ω–æ –¥–Ω–µ–π:</span>
                            <strong>{{ missed_days }}</strong>
                        </div>
                    </div>
                </div>

                <div class="claim-card mb-4">
                    <h5>üéØ –°–µ–≥–æ–¥–Ω—è—à–Ω—è—è –Ω–∞–≥—Ä–∞–¥–∞</h5>
                    <div class="today-reward">
                        {% if current_day % 7 == 0 %}
                        <div class="today-big">üéÅ 5,000 UC</div>
                        {% elif current_day % 3 == 0 %}
                        <div class="today-medium">üí∞ 1,000 UC</div>
                        {% else %}
                        <div class="today-small">‚ö° 500 UC</div>
                        {% endif %}
                    </div>
                    
                    {% if not claimed_today %}
                    <button class="btn btn-claim w-100 mt-3" onclick="claimDailyReward()">
                        üéÅ –ó–∞–±—Ä–∞—Ç—å –Ω–∞–≥—Ä–∞–¥—É
                    </button>
                    {% else %}
                    <div class="claimed-alert mt-3">
                        ‚úÖ –í—ã —É–∂–µ –∑–∞–±—Ä–∞–ª–∏ —Å–µ–≥–æ–¥–Ω—è—à–Ω—é—é –Ω–∞–≥—Ä–∞–¥—É
                    </div>
                    {% endif %}
                </div>

                <div class="timer-card">
                    <h5>‚è∞ –î–æ —Å–ª–µ–¥—É—é—â–µ–π –Ω–∞–≥—Ä–∞–¥—ã</h5>
                    <div class="countdown-timer" id="countdownTimer">
                        {{ next_reward_time }}
                    </div>
                    <small class="text-muted">–û–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –µ–∂–µ–¥–Ω–µ–≤–Ω–æ –≤ 00:00</small>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
function claimDailyReward() {
    fetch('/api/claim_daily_reward', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'}
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            showNotification(`üéâ –í—ã –ø–æ–ª—É—á–∏–ª–∏ ${data.reward} UC!`, 'success');
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É —á–µ—Ä–µ–∑ 2 —Å–µ–∫—É–Ω–¥—ã
            setTimeout(() => {
                location.reload();
            }, 2000);
        } else {
            showNotification(data.error || '–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –Ω–∞–≥—Ä–∞–¥—ã', 'error');
        }
    })
    .catch(error => {
        showNotification('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –Ω–∞–≥—Ä–∞–¥—ã', 'error');
    });
}

// –¢–∞–π–º–µ—Ä –æ–±—Ä–∞—Ç–Ω–æ–≥–æ –æ—Ç—Å—á–µ—Ç–∞
function updateCountdown() {
    const timerElement = document.getElementById('countdownTimer');
    if (!timerElement) return;

    const now = new Date();
    const tomorrow = new Date(now);
    tomorrow.setDate(tomorrow.getDate() + 1);
    tomorrow.setHours(0, 0, 0, 0);

    const diff = tomorrow - now;

    const hours = Math.floor(diff / (1000 * 60 * 60));
    const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
    const seconds = Math.floor((diff % (1000 * 60)) / 1000);

    timerElement.textContent = `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
}

// –ó–∞–ø—É—Å–∫–∞–µ–º —Ç–∞–π–º–µ—Ä
updateCountdown();
setInterval(updateCountdown, 1000);
</script>

<style>
.calendar-container {
    padding: 20px;
}

.calendar-main {
    background: rgba(45, 27, 105, 0.3);
    border: 2px solid #8a2be2;
    border-radius: 10px;
    padding: 20px;
}

.rewards-track {
    display: grid;
    grid-template-columns: repeat(6, 1fr);
    gap: 10px;
    margin-bottom: 20px;
}

.reward-item {
    background: rgba(255, 255, 255, 0.1);
    border: 2px solid #8a2be2;
    border-radius: 8px;
    padding: 10px;
    text-align: center;
    transition: all 0.3s ease;
}

.reward-item.available {
    border-color: #ffd700;
    background: rgba(255, 215, 0, 0.1);
    cursor: pointer;
}

.reward-item.available:hover {
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(255, 215, 0, 0.3);
}

.reward-item.locked {
    opacity: 0.5;
    background: rgba(255, 255, 255, 0.05);
}

.reward-day {
    font-size: 12px;
    color: #b19cd9;
    margin-bottom: 5px;
}

.reward-content {
    margin: 8px 0;
}

.reward-big {
    font-size: 24px;
}

.reward-medium {
    font-size: 20px;
}

.reward-small {
    font-size: 18px;
}

.reward-amount {
    font-size: 11px;
    color: #ffd700;
    font-weight: bold;
}

.reward-status {
    font-size: 10px;
}

.claimed {
    color: #28a745;
}

.available-text {
    color: #ffd700;
    font-weight: bold;
}

.locked-text {
    color: #6c757d;
}

.calendar-sidebar {
    background: rgba(45, 27, 105, 0.3);
    border: 2px solid #8a2be2;
    border-radius: 10px;
    padding: 20px;
}

.stats-card, .claim-card, .timer-card {
    background: rgba(0, 0, 0, 0.3);
    padding: 15px;
    border-radius: 8px;
    margin-bottom: 15px;
    border: 1px solid #8a2be2;
}

.stats-grid {
    display: flex;
    flex-direction: column;
    gap: 10px;
}

.stat {
    display: flex;
    justify-content: space-between;
    color: white;
    font-size: 14px;
}

.stat strong {
    color: #ffd700;
}

.today-reward {
    text-align: center;
    padding: 15px;
    background: rgba(255, 215, 0, 0.1);
    border: 2px solid #ffd700;
    border-radius: 8px;
    margin: 10px 0;
}

.today-big {
    font-size: 24px;
    color: #ffd700;
    font-weight: bold;
}

.today-medium {
    font-size: 20px;
    color: #ffd700;
    font-weight: bold;
}

.today-small {
    font-size: 18px;
    color: #ffd700;
    font-weight: bold;
}

.btn-claim {
    background: linear-gradient(45deg, #28a745, #20c997);
    border: none;
    color: white;
    padding: 12px;
    border-radius: 8px;
    font-weight: bold;
    font-size: 16px;
}

.btn-claim:hover:not(:disabled) {
    background: linear-gradient(45deg, #218838, #1e9c7a);
    transform: translateY(-2px);
}

.btn-claim:disabled {
    opacity: 0.5;
    cursor: not-allowed;
}

.claimed-alert {
    background: rgba(40, 167, 69, 0.2);
    border: 1px solid #28a745;
    color: #28a745;
    padding: 10px;
    border-radius: 6px;
    text-align: center;
    font-weight: bold;
}

.countdown-timer {
    font-size: 24px;
    font-weight: bold;
    color: #ffd700;
    text-align: center;
    margin: 10px 0;
}

.info-card {
    background: rgba(0, 0, 0, 0.3);
    padding: 15px;
    border-radius: 8px;
    border: 1px solid #8a2be2;
}

.info-card ul {
    color: #b19cd9;
    padding-left: 20px;
    margin-bottom: 0;
}

.info-card li {
    margin-bottom: 5px;
}

.text-muted {
    color: #6c757d !important;
}
</style>
{% endblock %}