{% extends "base.html" %}

{% block content %}
<div class="upgrade-container">
    <h1 class="text-center mb-4">‚ö° –£–ª—É—á—à–µ–Ω–∏–µ —Å–∫–∏–Ω–æ–≤</h1>

    <div class="row">
        <!-- –õ–µ–≤–∞—è —á–∞—Å—Ç—å - –≤—ã–±–æ—Ä —Å–∫–∏–Ω–∞ –∏ —É–ª—É—á—à–µ–Ω–∏—è -->
        <div class="col-md-5">
            <div class="upgrade-controls">
                <div class="select-skin-section mb-4">
                    <h4>üéí –í—ã–±–µ—Ä–∏—Ç–µ —Å–∫–∏–Ω –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è</h4>
                    <div class="inventory-list" id="inventoryList">
                        <!-- –°–∫–∏–Ω—ã –∏–∑ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã —á–µ—Ä–µ–∑ JS -->
                    </div>
                </div>

                <div class="select-target-section mb-4">
                    <h4>üéØ –í—ã–±–µ—Ä–∏—Ç–µ —Ü–µ–ª—å —É–ª—É—á—à–µ–Ω–∏—è</h4>
                    <div class="target-skins" id="targetSkins">
                        <div class="placeholder-text">–í—ã–±–µ—Ä–∏—Ç–µ —Å–∫–∏–Ω –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è</div>
                    </div>
                </div>

                <div class="upgrade-info">
                    <h5>üìä –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± —É–ª—É—á—à–µ–Ω–∏–∏</h5>
                    <div class="upgrade-stats">
                        <div class="stat-item">
                            <span>–¢–µ–∫—É—â–∏–π —Å–∫–∏–Ω:</span>
                            <span id="currentSkinName">–ù–µ –≤—ã–±—Ä–∞–Ω</span>
                        </div>
                        <div class="stat-item">
                            <span>–¶–µ–ª–µ–≤–æ–π —Å–∫–∏–Ω:</span>
                            <span id="targetSkinName">–ù–µ –≤—ã–±—Ä–∞–Ω</span>
                        </div>
                        <div class="stat-item">
                            <span>–®–∞–Ω—Å —É—Å–ø–µ—Ö–∞:</span>
                            <span id="successChance">0%</span>
                        </div>
                        <div class="stat-item">
                            <span>–°—Ç–æ–∏–º–æ—Å—Ç—å —É–ª—É—á—à–µ–Ω–∏—è:</span>
                            <span id="upgradeCost">0 UC</span>
                        </div>
                        <div class="stat-item">
                            <span>–ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–∞—è –ø—Ä–∏–±—ã–ª—å:</span>
                            <span id="potentialProfit">0 UC</span>
                        </div>
                    </div>

                    <button class="btn btn-upgrade" id="upgradeBtn" onclick="startUpgrade()" disabled>
                        ‚ö° –£–ª—É—á—à–∏—Ç—å
                    </button>
                </div>
            </div>
        </div>

        <!-- –ü—Ä–∞–≤–∞—è —á–∞—Å—Ç—å - –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç -->
        <div class="col-md-7">
            <div class="upgrade-info-sidebar">
                <div class="rules-section mb-4">
                    <h4>üìã –ü—Ä–∞–≤–∏–ª–∞ —É–ª—É—á—à–µ–Ω–∏—è</h4>
                    <div class="rules-list">
                        <div class="rule-item">
                            <span class="rule-icon">üéØ</span>
                            <span>–ú–æ–∂–Ω–æ —É–ª—É—á—à–∏—Ç—å —Å–∫–∏–Ω –Ω–∞ –Ω–µ—Å–∫–æ–ª—å–∫–æ —É—Ä–æ–≤–Ω–µ–π —Ä–µ–¥–∫–æ—Å—Ç–∏</span>
                        </div>
                        <div class="rule-item">
                            <span class="rule-icon">‚ö°</span>
                            <span>–®–∞–Ω—Å —É—Å–ø–µ—Ö–∞ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Ä–∞–∑–Ω–∏—Ü—ã –≤ —Ä–µ–¥–∫–æ—Å—Ç–∏</span>
                        </div>
                        <div class="rule-item">
                            <span class="rule-icon">üí•</span>
                            <span>–ü—Ä–∏ –Ω–µ—É–¥–∞—á–µ –∏—Å—Ö–æ–¥–Ω—ã–π —Å–∫–∏–Ω —Ç–µ—Ä—è–µ—Ç—Å—è</span>
                        </div>
                        <div class="rule-item">
                            <span class="rule-icon">üí∞</span>
                            <span>–°—Ç–æ–∏–º–æ—Å—Ç—å –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —à–∞–Ω—Å–∞ —É—Å–ø–µ—Ö–∞</span>
                        </div>
                        <div class="rule-item">
                            <span class="rule-icon">üé∞</span>
                            <span>–ß–µ–º –≤—ã—à–µ —à–∞–Ω—Å - —Ç–µ–º –º–µ–Ω—å—à–µ –ø—Ä–∏–±—ã–ª—å</span>
                        </div>
                    </div>
                </div>

                <div class="chances-section mb-4">
                    <h4>üé∞ –®–∞–Ω—Å—ã —É–ª—É—á—à–µ–Ω–∏—è</h4>
                    <div class="chances-list">
                        <div class="chance-item">
                            <span class="chance-badge chance-70">70% —à–∞–Ω—Å</span>
                            <span class="chance-desc">+1 —É—Ä–æ–≤–µ–Ω—å —Ä–µ–¥–∫–æ—Å—Ç–∏</span>
                            <span class="chance-cost">30% –æ—Ç —Ü–µ–Ω—ã</span>
                        </div>
                        <div class="chance-item">
                            <span class="chance-badge chance-50">50% —à–∞–Ω—Å</span>
                            <span class="chance-desc">+2 —É—Ä–æ–≤–Ω—è —Ä–µ–¥–∫–æ—Å—Ç–∏</span>
                            <span class="chance-cost">50% –æ—Ç —Ü–µ–Ω—ã</span>
                        </div>
                        <div class="chance-item">
                            <span class="chance-badge chance-30">30% —à–∞–Ω—Å</span>
                            <span class="chance-desc">+3 —É—Ä–æ–≤–Ω—è —Ä–µ–¥–∫–æ—Å—Ç–∏</span>
                            <span class="chance-cost">70% –æ—Ç —Ü–µ–Ω—ã</span>
                        </div>
                        <div class="chance-item">
                            <span class="chance-badge chance-15">15% —à–∞–Ω—Å</span>
                            <span class="chance-desc">+4 —É—Ä–æ–≤–Ω—è —Ä–µ–¥–∫–æ—Å—Ç–∏</span>
                            <span class="chance-cost">90% –æ—Ç —Ü–µ–Ω—ã</span>
                        </div>
                    </div>
                </div>

                <div class="upgrade-result" id="upgradeResult">
                    <h4>üìà –†–µ–∑—É–ª—å—Ç–∞—Ç —É–ª—É—á—à–µ–Ω–∏—è</h4>
                    <div class="result-placeholder">
                        <p>–ó–¥–µ—Å—å –±—É–¥–µ—Ç –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç —É–ª—É—á—à–µ–Ω–∏—è</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
// –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è
let selectedSkinId = null;
let selectedTarget = null;
let userInventory = [];

// –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
function getSkinRarity(skinPrice) {
    if (skinPrice <= 50) return 'common';
    if (skinPrice <= 300) return 'rare';
    if (skinPrice <= 1500) return 'epic';
    if (skinPrice <= 5000) return 'legendary';
    if (skinPrice <= 50000) return 'mythical';
    return 'ancient';
}

function getRarityName(rarity) {
    const names = {
        'common': '–û–±—ã—á–Ω—ã–π', 'rare': '–†–µ–¥–∫–∏–π', 'epic': '–≠–ø–∏—á–µ—Å–∫–∏–π',
        'legendary': '–õ–µ–≥–µ–Ω–¥–∞—Ä–Ω—ã–π', 'mythical': '–ú–∏—Ñ–∏—á–µ—Å–∫–∏–π', 'ancient': '–î—Ä–µ–≤–Ω–∏–π'
    };
    return names[rarity] || '–û–±—ã—á–Ω—ã–π';
}

function getUpgradeTargets(currentSkinPrice, currentRarity) {
    const rarityOrder = ['common', 'rare', 'epic', 'legendary', 'mythical', 'ancient'];
    const currentIndex = rarityOrder.indexOf(currentRarity);

    // –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö —Ü–µ–ª–µ–≤—ã—Ö —Å–∫–∏–Ω–æ–≤ (—É–ø—Ä–æ—â–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è)
    const targetDatabase = {
        'rare': [
            {id: 201, name: 'M416 - –ì–æ–ª—É–±–æ–π –õ–µ–¥', image: 'https://via.placeholder.com/100/007bff/ffffff?text=M416', price: 150},
            {id: 202, name: 'AKM - –ö—Ä–æ–≤–∞–≤—ã–π', image: 'https://via.placeholder.com/100/007bff/ffffff?text=AKM', price: 180}
        ],
        'epic': [
            {id: 401, name: 'M416 - –î—Ä–∞–∫–æ–Ω–∏–π –û–≥–æ–Ω—å', image: 'https://via.placeholder.com/100/8a2be2/ffffff?text=M416', price: 800},
            {id: 402, name: 'AKM - –í–∞–º–ø–∏—Ä', image: 'https://via.placeholder.com/100/8a2be2/ffffff?text=AKM', price: 900}
        ],
        'legendary': [
            {id: 601, name: 'M416 - IMMORTAL', image: 'https://via.placeholder.com/100/ff6b6b/ffffff?text=M416', price: 2500},
            {id: 602, name: 'AKM - BLOOD GOD', image: 'https://via.placeholder.com/100/ff6b6b/ffffff?text=AKM', price: 2800}
        ],
        'mythical': [
            {id: 801, name: 'M416 - UNIVERSE', image: 'https://via.placeholder.com/100/ff00ff/ffffff?text=M416', price: 15000},
            {id: 802, name: 'AKM - INFINITY', image: 'https://via.placeholder.com/100/ff00ff/ffffff?text=AKM', price: 20000}
        ],
        'ancient': [
            {id: 901, name: 'M416 - GOD SLAYER', image: 'https://via.placeholder.com/100/00ffff/ffffff?text=M416', price: 150000},
            {id: 902, name: 'AKM - INFINITY BLADE', image: 'https://via.placeholder.com/100/00ffff/ffffff?text=AKM', price: 200000}
        ]
    };

    let targets = [];

    // 70% —à–∞–Ω—Å - +1 —É—Ä–æ–≤–µ–Ω—å
    if (currentIndex + 1 < rarityOrder.length) {
        const rarity = rarityOrder[currentIndex + 1];
        targetDatabase[rarity]?.forEach(skin => {
            targets.push({
                ...skin,
                success_chance: 70,
                upgrade_cost: Math.floor(skin.price * 0.3),
                rarity_level: 1
            });
        });
    }

    // 50% —à–∞–Ω—Å - +2 —É—Ä–æ–≤–Ω—è
    if (currentIndex + 2 < rarityOrder.length) {
        const rarity = rarityOrder[currentIndex + 2];
        targetDatabase[rarity]?.forEach(skin => {
            targets.push({
                ...skin,
                success_chance: 50,
                upgrade_cost: Math.floor(skin.price * 0.5),
                rarity_level: 2
            });
        });
    }

    // 30% —à–∞–Ω—Å - +3 —É—Ä–æ–≤–Ω—è
    if (currentIndex + 3 < rarityOrder.length) {
        const rarity = rarityOrder[currentIndex + 3];
        targetDatabase[rarity]?.forEach(skin => {
            targets.push({
                ...skin,
                success_chance: 30,
                upgrade_cost: Math.floor(skin.price * 0.7),
                rarity_level: 3
            });
        });
    }

    // 15% —à–∞–Ω—Å - +4 —É—Ä–æ–≤–Ω—è
    if (currentIndex + 4 < rarityOrder.length) {
        const rarity = rarityOrder[currentIndex + 4];
        targetDatabase[rarity]?.forEach(skin => {
            targets.push({
                ...skin,
                success_chance: 15,
                upgrade_cost: Math.floor(skin.price * 0.9),
                rarity_level: 4
            });
        });
    }

    return targets;
}

// –ó–∞–≥—Ä—É–∂–∞–µ–º –∏–Ω–≤–µ–Ω—Ç–∞—Ä—å –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
document.addEventListener('DOMContentLoaded', function() {
    loadInventory();
});

function loadInventory() {
    fetch('/api/get_inventory')
        .then(response => response.json())
        .then(data => {
            userInventory = data.skins;
            displayInventory();
        });
}

function displayInventory() {
    const inventoryList = document.getElementById('inventoryList');
    inventoryList.innerHTML = '';

    if (userInventory.length === 0) {
        inventoryList.innerHTML = '<p class="text-center">–ò–Ω–≤–µ–Ω—Ç–∞—Ä—å –ø—É—Å—Ç</p>';
        return;
    }

    userInventory.forEach(skin => {
        const skinElement = document.createElement('div');
        const rarity = getSkinRarity(skin.price);
        skinElement.className = `inventory-skin-item ${selectedSkinId === skin.id ? 'selected' : ''}`;
        skinElement.onclick = () => selectSkin(skin.id);
        skinElement.innerHTML = `
            <img src="${skin.image}" alt="${skin.name}">
            <div class="skin-details">
                <h6>${skin.name}</h6>
                <span class="skin-price">${skin.price.toLocaleString()} UC</span>
                <span class="skin-rarity ${rarity}">${getRarityName(rarity)}</span>
            </div>
        `;
        inventoryList.appendChild(skinElement);
    });
}

function displayTargetSkins() {
    const targetSkins = document.getElementById('targetSkins');
    targetSkins.innerHTML = '';

    if (!selectedSkinId) {
        targetSkins.innerHTML = '<div class="placeholder-text">–í—ã–±–µ—Ä–∏—Ç–µ —Å–∫–∏–Ω –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è</div>';
        return;
    }

    const currentSkin = userInventory.find(s => s.id === selectedSkinId);
    if (!currentSkin) return;

    const currentRarity = getSkinRarity(currentSkin.price);
    const upgradeTargets = getUpgradeTargets(currentSkin.price, currentRarity);

    if (upgradeTargets.length === 0) {
        targetSkins.innerHTML = '<div class="placeholder-text">–î–æ—Å—Ç–∏–≥–Ω—É—Ç –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å —É–ª—É—á—à–µ–Ω–∏—è</div>';
        return;
    }

    upgradeTargets.forEach(target => {
        const skinElement = document.createElement('div');
        const rarity = getSkinRarity(target.price);
        const isSelected = selectedTarget && selectedTarget.id === target.id;
        skinElement.className = `target-skin-item ${isSelected ? 'selected' : ''}`;
        skinElement.onclick = () => selectTarget(target);
        skinElement.innerHTML = `
            <img src="${target.image}" alt="${target.name}">
            <div class="skin-details">
                <h6>${target.name}</h6>
                <span class="skin-price">${target.price.toLocaleString()} UC</span>
                <span class="skin-rarity ${rarity}">${getRarityName(rarity)}</span>
                <div class="upgrade-info">
                    <span class="chance-badge chance-${target.success_chance}">${target.success_chance}% —à–∞–Ω—Å</span>
                    <span class="level-info">+${target.rarity_level} —É—Ä–æ–≤–µ–Ω—å</span>
                    <span class="cost-info">${target.upgrade_cost.toLocaleString()} UC</span>
                </div>
            </div>
        `;
        targetSkins.appendChild(skinElement);
    });
}

function selectSkin(skinId) {
    selectedSkinId = skinId;
    selectedTarget = null;
    displayInventory();
    displayTargetSkins();
    updateUpgradeInfo();
}

function selectTarget(target) {
    selectedTarget = target;
    displayTargetSkins();
    updateUpgradeInfo();
}

function updateUpgradeInfo() {
    const currentSkinName = document.getElementById('currentSkinName');
    const targetSkinName = document.getElementById('targetSkinName');
    const successChance = document.getElementById('successChance');
    const upgradeCost = document.getElementById('upgradeCost');
    const potentialProfit = document.getElementById('potentialProfit');
    const upgradeBtn = document.getElementById('upgradeBtn');

    if (!selectedSkinId) {
        currentSkinName.textContent = '–ù–µ –≤—ã–±—Ä–∞–Ω';
        targetSkinName.textContent = '–ù–µ –≤—ã–±—Ä–∞–Ω';
        successChance.textContent = '0%';
        upgradeCost.textContent = '0 UC';
        potentialProfit.textContent = '0 UC';
        upgradeBtn.disabled = true;
        return;
    }

    const currentSkin = userInventory.find(s => s.id === selectedSkinId);
    currentSkinName.textContent = currentSkin.name;

    if (!selectedTarget) {
        targetSkinName.textContent = '–ù–µ –≤—ã–±—Ä–∞–Ω';
        successChance.textContent = '0%';
        upgradeCost.textContent = '0 UC';
        potentialProfit.textContent = '0 UC';
        upgradeBtn.disabled = true;
        return;
    }

    targetSkinName.textContent = selectedTarget.name;
    successChance.textContent = selectedTarget.success_chance + '%';
    upgradeCost.textContent = selectedTarget.upgrade_cost.toLocaleString() + ' UC';

    const profit = selectedTarget.price - selectedTarget.upgrade_cost - currentSkin.price;
    potentialProfit.textContent = profit.toLocaleString() + ' UC';
    potentialProfit.className = profit >= 0 ? 'text-success' : 'text-danger';

    upgradeBtn.disabled = false;
}

function startUpgrade() {
    if (!selectedSkinId || !selectedTarget) return;

    const upgradeBtn = document.getElementById('upgradeBtn');
    upgradeBtn.disabled = true;
    upgradeBtn.textContent = '–£–ª—É—á—à–∞–µ—Ç—Å—è...';

    const currentSkin = userInventory.find(s => s.id === selectedSkinId);

    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –±–∞–ª–∞–Ω—Å
    fetch('/api/get_user_info')
        .then(response => response.json())
        .then(userData => {
            if (userData.balance < selectedTarget.upgrade_cost) {
                showNotification('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ UC –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è!', 'error');
                upgradeBtn.disabled = false;
                upgradeBtn.textContent = '‚ö° –£–ª—É—á—à–∏—Ç—å';
                return;
            }

            // –°–∏–º—É–ª–∏—Ä—É–µ–º —É–ª—É—á—à–µ–Ω–∏–µ
            const isSuccess = Math.random() * 100 < selectedTarget.success_chance;

            setTimeout(() => {
                showUpgradeResult(isSuccess, currentSkin, selectedTarget);

                if (isSuccess) {
                    fetch('/api/upgrade_success', {
                        method: 'POST',
                        headers: {'Content-Type': 'application/json'},
                        body: JSON.stringify({
                            skin_id: selectedSkinId,
                            target_id: selectedTarget.id,
                            cost: selectedTarget.upgrade_cost
                        })
                    }).then(() => {
                        updateHeaderBalance();
                        loadInventory();
                    });
                } else {
                    fetch('/api/upgrade_fail', {
                        method: 'POST',
                        headers: {'Content-Type': 'application/json'},
                        body: JSON.stringify({
                            skin_id: selectedSkinId,
                            cost: selectedTarget.upgrade_cost
                        })
                    }).then(() => {
                        updateHeaderBalance();
                        loadInventory();
                    });
                }

                upgradeBtn.disabled = false;
                upgradeBtn.textContent = '‚ö° –£–ª—É—á—à–∏—Ç—å';

            }, 2000);
        });
}

function showUpgradeResult(success, currentSkin, target) {
    if (success) {
        playSound('upgradeSuccessSound');
    } else {
        playSound('upgradeFailSound');
    }
    const resultDiv = document.getElementById('upgradeResult');
    const currentRarity = getSkinRarity(currentSkin.price);
    const targetRarity = getSkinRarity(target.price);

    if (success) {
        resultDiv.innerHTML = `
            <div class="result-success">
                <h4 class="text-success">üéâ –£–ª—É—á—à–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ!</h4>
                <div class="upgrade-animation">
                    <div class="old-skin">
                        <img src="${currentSkin.image}" alt="${currentSkin.name}">
                        <span class="skin-rarity ${currentRarity}">${getRarityName(currentRarity)}</span>
                        <span>${currentSkin.name}</span>
                    </div>
                    <div class="arrow">‚ö°‚û°Ô∏è‚ö°</div>
                    <div class="new-skin">
                        <img src="${target.image}" alt="${target.name}">
                        <span class="skin-rarity ${targetRarity}">${getRarityName(targetRarity)}</span>
                        <span>${target.name}</span>
                    </div>
                </div>
                <div class="profit-info">
                    <p class="success-text">‚úÖ –ü—Ä–∏–±—ã–ª—å: +${(target.price - target.upgrade_cost - currentSkin.price).toLocaleString()} UC</p>
                    <p class="chance-info">–®–∞–Ω—Å —É—Å–ø–µ—Ö–∞: ${target.success_chance}%</p>
                </div>
            </div>
        `;
        showNotification(`üéâ –£–ª—É—á—à–µ–Ω–∏–µ –Ω–∞ ${target.success_chance}% –ø—Ä–æ—à–ª–æ —É—Å–ø–µ—à–Ω–æ!`);
    } else {
        resultDiv.innerHTML = `
            <div class="result-fail">
                <h4 class="text-danger">üí• –£–ª—É—á—à–µ–Ω–∏–µ –Ω–µ —É–¥–∞–ª–æ—Å—å</h4>
                <div class="failed-animation">
                    <div class="failed-skin">
                        <img src="${currentSkin.image}" alt="${currentSkin.name}" class="broken">
                        <span class="skin-rarity ${currentRarity}">${getRarityName(currentRarity)}</span>
                        <span>${currentSkin.name}</span>
                    </div>
                    <div class="explosion">üí•</div>
                </div>
                <div class="loss-info">
                    <p class="fail-text">‚ùå –ü–æ—Ç–µ—Ä—è–Ω–æ: ${currentSkin.price.toLocaleString()} UC + ${target.upgrade_cost.toLocaleString()} UC</p>
                    <p class="chance-info">–®–∞–Ω—Å —É—Å–ø–µ—Ö–∞ –±—ã–ª: ${target.success_chance}%</p>
                </div>
            </div>
        `;
        showNotification(`üí• –£–ª—É—á—à–µ–Ω–∏–µ –Ω–∞ ${target.success_chance}% –Ω–µ —É–¥–∞–ª–æ—Å—å`, 'error');
    }
}
</script>

<style>
.upgrade-container {
    padding: 20px;
}

.upgrade-controls {
    background: rgba(45, 27, 105, 0.3);
    border: 2px solid #8a2be2;
    border-radius: 10px;
    padding: 20px;
    height: 100%;
}

.upgrade-info-sidebar {
    background: rgba(45, 27, 105, 0.3);
    border: 2px solid #8a2be2;
    border-radius: 10px;
    padding: 20px;
    height: 100%;
}

/* –°—Ç–∏–ª–∏ –¥–ª—è —Å–ø–∏—Å–∫–∞ —Å–∫–∏–Ω–æ–≤ */
.inventory-list, .target-skins {
    max-height: 300px;
    overflow-y: auto;
    margin-bottom: 15px;
}

.inventory-skin-item, .target-skin-item {
    display: flex;
    align-items: center;
    padding: 12px;
    margin-bottom: 10px;
    background: rgba(255, 255, 255, 0.1);
    border: 2px solid #8a2be2;
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.3s ease;
}

.inventory-skin-item:hover, .target-skin-item:hover {
    background: rgba(138, 43, 226, 0.2);
    transform: translateY(-2px);
    border-color: #ffd700;
}

.inventory-skin-item.selected, .target-skin-item.selected {
    background: rgba(138, 43, 226, 0.4);
    border-color: #ffd700;
    box-shadow: 0 0 15px rgba(255, 215, 0, 0.3);
}

.inventory-skin-item img, .target-skin-item img {
    width: 60px;
    height: 60px;
    object-fit: contain;
    margin-right: 15px;
    border-radius: 6px;
    border: 1px solid #8a2be2;
}

.skin-details {
    flex: 1;
}

.skin-details h6 {
    margin: 0 0 5px 0;
    color: white;
    font-size: 14px;
}

.skin-price {
    color: #ffd700;
    font-weight: bold;
    font-size: 12px;
    display: block;
    margin-bottom: 3px;
}

.skin-rarity {
    font-size: 10px;
    padding: 3px 8px;
    border-radius: 10px;
    font-weight: bold;
}

.skin-rarity.common { background: #6c757d; }
.skin-rarity.rare { background: #007bff; }
.skin-rarity.epic { background: #8a2be2; }
.skin-rarity.legendary { background: #ff6b6b; }
.skin-rarity.mythical { background: #ff00ff; }
.skin-rarity.ancient { background: #00ffff; color: black; }

.upgrade-info {
    margin-top: 10px;
    padding-top: 10px;
    border-top: 1px solid #8a2be2;
}

.chance-badge {
    font-size: 10px;
    padding: 3px 8px;
    border-radius: 8px;
    font-weight: bold;
    margin-right: 5px;
}

.chance-70 { background: #28a745; color: white; }
.chance-50 { background: #ffc107; color: black; }
.chance-30 { background: #fd7e14; color: white; }
.chance-15 { background: #dc3545; color: white; }

.level-info {
    font-size: 9px;
    color: #b19cd9;
    margin-right: 5px;
}

.cost-info {
    font-size: 11px;
    color: #ffd700;
    font-weight: bold;
}

/* –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± —É–ª—É—á—à–µ–Ω–∏–∏ */
.upgrade-stats {
    background: rgba(0, 0, 0, 0.3);
    padding: 15px;
    border-radius: 8px;
    margin-bottom: 15px;
    border: 1px solid #8a2be2;
}

.stat-item {
    display: flex;
    justify-content: space-between;
    margin-bottom: 8px;
    color: white;
    font-size: 14px;
}

.stat-item span:last-child {
    color: #ffd700;
    font-weight: bold;
}

.btn-upgrade {
    background: linear-gradient(45deg, #8a2be2, #4b0082);
    border: none;
    color: white;
    padding: 15px;
    border-radius: 8px;
    font-weight: bold;
    font-size: 16px;
    width: 100%;
    transition: all 0.3s ease;
    margin-top: 10px;
}

.btn-upgrade:hover:not(:disabled) {
    background: linear-gradient(45deg, #9b4dff, #5a00a8);
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(138, 43, 226, 0.4);
}

.btn-upgrade:disabled {
    opacity: 0.5;
    cursor: not-allowed;
}

/* –ü—Ä–∞–≤–∏–ª–∞ –∏ —à–∞–Ω—Å—ã */
.rules-list {
    background: rgba(0, 0, 0, 0.3);
    padding: 15px;
    border-radius: 8px;
    border: 1px solid #8a2be2;
}

.rule-item {
    display: flex;
    align-items: center;
    margin-bottom: 10px;
    color: #b19cd9;
    font-size: 14px;
}

.rule-icon {
    font-size: 18px;
    margin-right: 10px;
    min-width: 20px;
}

.chances-list {
    background: rgba(0, 0, 0, 0.3);
    padding: 15px;
    border-radius: 8px;
    border: 1px solid #8a2be2;
}

.chance-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 10px;
    padding: 10px;
    background: rgba(255, 255, 255, 0.1);
    border-radius: 6px;
}

.chance-desc {
    flex: 1;
    margin: 0 10px;
    color: white;
    font-size: 13px;
}

.chance-cost {
    color: #ffd700;
    font-weight: bold;
    font-size: 12px;
}

/* –†–µ–∑—É–ª—å—Ç–∞—Ç —É–ª—É—á—à–µ–Ω–∏—è */
.upgrade-result {
    background: rgba(0, 0, 0, 0.3);
    padding: 20px;
    border-radius: 8px;
    min-height: 250px;
    border: 1px solid #8a2be2;
}

.placeholder-text {
    text-align: center;
    color: #b19cd9;
    padding: 40px 0;
    font-style: italic;
}

.upgrade-animation, .failed-animation {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 20px;
    margin: 20px 0;
    flex-wrap: wrap;
}

.old-skin, .new-skin, .failed-skin {
    text-align: center;
    padding: 15px;
    background: rgba(255, 255, 255, 0.1);
    border-radius: 10px;
    border: 2px solid #8a2be2;
}

.old-skin img, .new-skin img, .failed-skin img {
    width: 80px;
    height: 80px;
    object-fit: contain;
    border-radius: 8px;
    margin-bottom: 8px;
}

.failed-skin img.broken {
    filter: grayscale(1) brightness(0.5);
}

.arrow {
    font-size: 24px;
    color: #ffd700;
}

.explosion {
    font-size: 40px;
    animation: explode 0.5s ease;
}

@keyframes explode {
    0% { transform: scale(1); }
    50% { transform: scale(1.5); }
    100% { transform: scale(1); }
}

.success-text {
    color: #28a745;
    font-weight: bold;
    text-align: center;
    margin: 10px 0;
}

.fail-text {
    color: #dc3545;
    font-weight: bold;
    text-align: center;
    margin: 10px 0;
}

.chance-info {
    color: #b19cd9;
    text-align: center;
    font-size: 14px;
}

.profit-info, .loss-info {
    text-align: center;
    margin-top: 15px;
}

.text-success { color: #28a745 !important; }
.text-danger { color: #dc3545 !important; }
</style>
{% endblock %}